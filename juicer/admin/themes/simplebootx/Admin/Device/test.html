<admintpl file="header" />
<style>
    .test li,.tests li{
        list-style: none;
        width:22%;
        float: left;
        padding: 1%;
    }
    .um-list li {
        list-style: none;
        float: left;
        margin-left: 10px;
    }
    .ui-btn-dangers{
        font-size: 12px;
        height: 44px;
        line-height: 42px;
        display: block;
        color: #333;
        width: 100%;
        border-radius:1px;
        background: #fff;
        border-bottom: 1px solid #39f;
    }
    .OFF .ui-btn-dangers{
        background: #e5e0e0;
    }
    .half .ui-btn-dangers{
        background: #f06d5e;
    }
    .ON .ui-btn-dangers{
        background:#4cd664;
    }
    .ui-btn-lg{
        width: 90%;
        margin: auto;
        border-radius: 2px;
    }
    .clear{
        clear: both;
    }
</style>
</head>
<body>
<div class="wrap">
    <ul class="nav nav-tabs">
        <li><a href="{:U('Device/index')}">设备信息列表</a></li>
        <li class="active"><a href="">设备调试</a></li>
    </ul>
    <p>请选择对应按钮调试（绿色为开，灰色为关）</p>
        <fieldset>
            <ul class="test">
                <li data="ON" bit="0" class="ON" dataid="">
                    <button class="ui-btn-dangers" type="button">急停（开）</button>
                </li>
                <li data="OFF" bit="0" class="OFF" dataid="">
                    <button class="ui-btn-dangers" type="button">急停（关）</button>
                </li>
                <li data="ON" bit="1" class="ON" dataid="">
                    <button class="ui-btn-dangers" type="button">故障复位（开）</button>
                </li>
                <li data="OFF" bit="1" class="OFF" dataid="">
                    <button class="ui-btn-dangers" type="button">故障复位（关）</button>
                </li>
                <li data="ON" bit="3" class="ON" dataid="">
                    <button class="ui-btn-dangers" type="button">手自动切换（开）</button>
                </li>
                <li data="OFF" bit="3" class="OFF" dataid="">
                    <button class="ui-btn-dangers" type="button">手自动切换（关）</button>
                </li>
                <li data="ON" bit="4" class="ON" dataid="">
                    <button class="ui-btn-dangers" type="button">手动一层电机（开）</button>
                </li>
                <li data="OFF" bit="4" class="OFF" dataid="">
                    <button class="ui-btn-dangers" type="button">手动一层电机（关）</button>
                </li>
                <li data="ON" bit="5" class="ON" dataid="">
                    <button class="ui-btn-dangers" type="button">手动二层电机（开）</button>
                </li>
                <li data="OFF" bit="5" class="OFF" dataid="">
                    <button class="ui-btn-dangers" type="button">手动二层电机（关）</button>
                </li>
                <li data="ON" bit="6" class="ON" dataid="">
                    <button class="ui-btn-dangers" type="button">手动三层电机（开）</button>
                </li>
                <li data="OFF" bit="6" class="OFF" dataid="">
                    <button class="ui-btn-dangers" type="button">手动三层电机（关）</button>
                </li>
                <li data="ON" bit="7" class="ON" dataid="">
                    <button class="ui-btn-dangers" type="button">手动榨汁电机（开）</button>
                </li>
                <li data="OFF" bit="7" class="OFF" dataid="">
                    <button class="ui-btn-dangers" type="button">手动榨汁电机（关）</button>
                </li>
                <li data="ON" bit="8" class="ON" dataid="">
                    <button class="ui-btn-dangers" type="button">手动落杯电机（开）</button>
                </li>
                <li data="OFF" bit="8" class="OFF" dataid="">
                    <button class="ui-btn-dangers" type="button">手动落杯电机（关）</button>
                </li>
                <li data="ON" bit="9" class="ON" dataid="">
                    <button class="ui-btn-dangers" type="button">手动落盖电机（开）</button>
                </li>
                <li data="OFF" bit="9" class="OFF" dataid="">
                    <button class="ui-btn-dangers" type="button">手动落盖电机（关）</button>
                </li>
                <li data="ON" bit="10" class="ON" dataid="">
                    <button class="ui-btn-dangers" type="button">手动托盘旋转电机（开）</button>
                </li>
                <li data="OFF" bit="10" class="OFF" dataid="">
                    <button class="ui-btn-dangers" type="button">手动托盘旋转电机（关）</button>
                </li>
                <li data="ON" bit="11" class="ON" dataid="">
                    <button class="ui-btn-dangers" type="button">手动压盖电机下（开）</button>
                </li>
                <li data="OFF" bit="11" class="OFF" dataid="">
                    <button class="ui-btn-dangers" type="button">手动压盖电机下（关）</button>
                </li>
                <li data="ON" bit="12" class="ON" dataid="">
                    <button class="ui-btn-dangers" type="button">手动压盖电机上（开）</button>
                </li>
                <li data="OFF" bit="12" class="OFF" dataid="">
                    <button class="ui-btn-dangers" type="button">手动压盖电机上（关）</button>
                </li>
                <li data="ON" bit="13" class="ON" dataid="">
                    <button class="ui-btn-dangers" type="button">手动储汁电机动作（开）</button>
                </li>
                <li data="OFF" bit="13" class="OFF" dataid="">
                    <button class="ui-btn-dangers" type="button">手动储汁电机动作（关）</button>
                </li>
                <li data="TRIG" bit="2" dataid="">
                    <button class="ui-btn-dangers" type="button">付款完成</button>
                </li>
                <li data="TRIG" bit="14" dataid="">
                    <button class="ui-btn-dangers" type="button">使用橙子个数清零</button>
                </li>
                <li data="TRIG" bit="15" dataid="">
                    <button class="ui-btn-dangers" type="button">榨汁杯数清零</button>
                </li>
            </ul>
            <div class="clear"></div>
            <p>16字节写命令</p>
            <ul class="um-list um-list-form" id="J_TJJJRPhone">
                <li><label class="control-label">WRT_REG</label><input type="number" class="WRT_REG" pattern="[0-9]*" placeholder="请输入命令" id="customer_name"></li>
                <li><label class="control-label">VAL16</label><input type="number" class="VAL16" pattern="[0-9]*" placeholder="请输入命令" id="customer_phone"></li>
            </ul>
            <div class="space-10"></div>
            <button class="ui-btn-lg btn-primary ui-btn-danger test_16" type="button" id="J_submitCustomer">发送</button>
            <br/>
            <p>云端读取</p>
            <ul class="tests">
                <li data="34" bit="0" class="ON">
                    <button class="ui-btn-dangers" type="button">橙子使用个数统计</button>
                </li>
                <li data="36" bit="1" class="ON">
                    <button class="ui-btn-dangers" type="button">榨汁杯数统计</button>
                </li>
                <li data="110" bit="1" class="ON">
                    <button class="ui-btn-dangers" type="button">发送110命令</button>
                </li>
                <li data="111" bit="1" class="ON">
                    <button class="ui-btn-dangers" type="button">发送111命令</button>
                </li>
                <li data="112" bit="1" class="ON" style="    margin-bottom: 71px;">
                    <button class="ui-btn-dangers" type="button">发送112命令</button>
                </li>
            </ul>
            <br/><br/><br/>
        </fieldset>
        <div class="form-actions">
            <a class="btn" href="javascript:history.back(-1);">返回</a>
        </div>
</div>
<input type="hidden" class="device_command" value="{$detail.device_command}"/>
<input type="hidden" class="send_device_command" value="{:U('send_test_device')}"/>
<script src="__PUBLIC__/js/common.js"></script>
<script>
    $('.test li').click(function () {
        if($(this).find(':button').hasClass('on')){
            return false;
        }
        var html = $(this).find(':button').html();
        $(this).find(':button').html('正在调试...').addClass('on');
        var status = $(this).attr('data');
        var dataid = $(this).attr('dataid');
        var BIT = $(this).attr('bit');
        var send_url = $('.send_device_command').val();
        var device_command = $('.device_command').val();
        var THIS = $(this);
        if(status == 'TRIG'){
            $.post("{:U('TRIG')}",{device_command: device_command,
                status:status,BIT:BIT},function(res){
                THIS.find(':button').html(html).removeClass('on');
                if(res.code == 200){
                   alert(res.msg);
                }else{
                    alert(res.msg);
                }
            },'json')
        }else{
            var DATA = {device_command: device_command,status:status,BIT:BIT};
                $.post(send_url, DATA, function (data) {
                    THIS.find(':button').html(html).removeClass('on');
                    //THIS.attr('class','half');
                    if (data.code == 200) {
                        //THIS.attr('dataid',data.result);
                        alert(data.msg);
                    }else{
                        alert(data.msg);
                    }
                }, 'json');
        }
    });
    //16位调试
    $('.test_16').click(function () {
        if($(this).hasClass('on')){
            return false;
        }
        var WRT_REG = $('.WRT_REG').val();
        var VAL16 = $('.VAL16').val();
        if(WRT_REG == '' || VAL16 == ''){
            alert('请输入命令');
            return false;
        }
        var html = $(this).html();
        $(this).html('正在调试...').addClass('on');
        var device_command = $('.device_command').val();
        var THIS = $(this);
        var DATA = {WRT_REG: WRT_REG,VAL16:VAL16,device_command:device_command};
        $.post("{:U('send_test_16')}", DATA, function (data) {
            THIS.html(html).removeClass('on');
            if (data.code == 200) {
                alert(data.msg);
            }else{
                alert(data.msg);
            }
        }, 'json');
    });
    //发送110命令
    $('.tests li').click(function () {
        if($(this).find(':button').hasClass('on')){
            return false;
        }
        var html = $(this).find(':button').html();
        var status = $(this).attr('data');
        $(this).find(':button').html('正在调试...');
        var THIS = $(this);
        var device_command = $('.device_command').val();
        var DATA = {device_command: device_command,status:status};
        $.post("{:U('send_110')}", DATA, function (data) {
            THIS.find(':button').html(html);
            if (data.code == 200) {
                alert(data.msg);
            }else{
                alert(data.msg);
            }
        }, 'json');
    });
</script>
</body>
</html>